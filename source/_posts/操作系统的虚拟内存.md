---
title: 操作系统的虚拟内存
date: 2021-01-23 12:12:22
tags:
- 操作系统
---
## 虚拟内存的设计目标
### 透明
让运行的程序像是拥有整个物理内存,物理内存的管理由操作系统负责
### 效率
操作系统需要保证内存虚拟化在时间和空间上的效率.也即不会导致程序运行太慢,也不会造成太多的内存浪费
### 保护
虚拟内存需要保证不同进程之间互相隔离,从而保证一个进程的崩溃不会影响其他进程.

## 分页与分段

### 分页

将程序分为固定大小的块,每个块存在不同的区域,使用页表定位一条指令具体的存放位置

页表中存放虚拟页号 物理页号

#### 特点

不容易造成内存浪费,可以将一块较大的区域分割成多个块,分别放置在不同的位置

需要设置好页大小,不能太大,太大会造成页内部的内存浪费.太小会需要更多的页,造成页表变得很大.

### 分段

将地址空间分成不同的段,比如代码段 堆段 栈段等,可以将不同的段存储在不同的地方.操作系统使用段寄存器保存各个段的基址和大小.

#### 特点

将程序划分为逻辑上独立的内存空间,有利于共享和保护

### 段页式

首先将程序分为逻辑上独立的段,再将各个段分为大小相同的页.既有了分段对于内存的保护,又有了分页减小内存浪费的特性.

## 多级页表

### 段页式的缺点
- 如果堆比较稀疏,会造成比较严重的内存浪费 
- 页表的大小可以为任意值,因此为页表寻找存储空间将变得十分困难.

因此引出多级页表

### 多级页表的访问过程

- 访问TLB,如果命中则直接寻址
- TLB没有命中,访问页目录,找到页表的位置
- 访问页表,如果存在位为1,定位具体对应的物理地址
- 存在位为0,说明页内容存储在磁盘中,需要唤醒操作系统在磁盘中找到相应的信息
