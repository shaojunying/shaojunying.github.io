---
title: Redis的五种对象使用的数据结构
date: 2020-11-02 21:03:40
tags:
- Redis
- 数据库
---

## 简单动态字符串(SDS)

### 属性

- len:长度(字符数组中已使用的字节数)
- free:未使用的字节数
- buf: 分配的子节数组

### 几个注意事项

#### 空间预分配

在为SDS分配空间时,如果其占用空间小于1M,就为其分配需要空间的2倍,否则就在需要的空间之外额外分配1M

#### 惰性释放

SDS不会立即回收缩短之后多出来的字节

#### 二进制安全

不同于c字符串使用'\0'字符来计算字符串的长度,SDS使用字段len,从而可以存储二进制数据,例如图片...

## 链表

### 特点

- 无环
- 双向
- 包含头尾节点
- 带有长度

## 对象使用的基本数据结构

### 字符串对象

- 整数
- embstr简单动态字符串(简化的SDS)
- 简单动态祖父穿

### 列表对象

- 压缩列表
- 双向链表

### 哈希对象

- 压缩列表
- 字典(key存储值,value为null)

### 集合

- 整数集合
- 字典

### 有序集合

- 压缩列表
- 跳跃表+字典
  - 跳跃表用来实现范围查询
  - 字典用于对象到分数的映射

## Redis对象

对象中有一个字段lru用来记录该对象最后一次被访问的时间

lru值越小，说明空转时间越长，如果服务端开启了maxmemory，redis在内存超过max_memory时,删除空转时间最长的键