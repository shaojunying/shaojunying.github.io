---
title: IO复用的select poll epoll模型
date: 2021-01-21 17:19:54
tags:
- 操作系统
- IO
---
## Select
在调用select之前,需要先将要监听的事件和监听的类型(读完成,写完成,异常)放入指定集合中,之后调用select函数.select函数将会轮询每个事件,最终将满足可读写的事件集合返回
### 缺点
- **由于集合的底层是使用数组实现的,所以大小有限制**. 而现在的服务器需要同时处理大量的IO
- **每次执行select操作的时候,都需要将事件集合复制进操作系统集合**. 事件很多时将会比较耗时
- **每次select操作都需要轮询所有的fd(文件描述符)**. 也是十分耗时
## Poll
poll与select非常类似,他的改进主要是两个方面: 
- **使用链表代替数组**, 解决了**监听的fd最大长度固定的问题**
- **使用pollfd**, **避免了每次进行select操作都需要复制所有的fd**
pollfd的类结构如下
```Java
class pollfd{
    int fd, // 文件描述符
    short events, // 注册的事件类型
    short revents // 实际发生的事件(内核填充)
}
```
## Epoll
在系统内核中创建一个事件监听表,应用程序直接向内核中添加和删除需要监听的事件,同时提前定义好回调函数,文件读写完成时将直接执行回调函数
### 优点
- **内核中的事件监听表底层基于B+树**, 解决了**长度有限的问题**
- **应用程序直接向内核中添加和删除**, 避免了**多次复制造成的开销**
- **提前定义好回调函数**, 避免了**每次调用select需要遍历所有的事件**