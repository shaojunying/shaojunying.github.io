<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;📖&lt;/text&gt;&lt;/svg&gt;">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>HTTP认证方式&nbsp;|&nbsp;Junying Shao&#39;s Blog</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="HTTP认证方式">
  
  
    <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🧵&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;📖&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="a02052e3680d4565b9626657d9a29dd8.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🌞&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>JVM学习</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;😀&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>About</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</nav>
  <header class="Header">
    
      <div class="Header__Cover">
        <img src="https://www.notion.so/images/page-cover/rijksmuseum_claesz_1628.jpg">
      </div>
    
    <div class="Header__Spacer ">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🧵&lt;/text&gt;&lt;/svg&gt;"></span>
      </div>
    
    <h1 class="Header__Title">HTTP认证方式</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Sun, Apr 3, 2022</span>
        
        
      </div>
    
  </header>
  <article id="https://www.notion.so/99dc0c605af64702a1d9d3087193c43b" class="PageRoot"><ul id="https://www.notion.so/4ce329110f3340399c65ac29b680f4f7" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/d33ece48ec6545f8b55e270c6658de0b"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">HTTP Basic Authentication</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/8e7d13e2ee1f45bb8ab151c44891ee6e"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">认证过程</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/43573e6438a6487ea64fbcfa411b697b"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">优点</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/b0a0c4f23f8e4261b8ad73ef8a1fafde"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">缺点</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/5bcac628a404491faa383e4284155634"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">HTTP Digest Authentication（HTTP摘要认证）</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/dfa9a12d307a459480bd522907da9590"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">认证过程</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/ae80d802c82b434da68001f9e0290e88"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">优点</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/51ee6e0d09a940fd86173c4d4878381d"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">缺点</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/e4736dd2195b4fa0bea68999663c3cb3"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">HTTP Bearer Authentication（HTTP持有人认证Oauth2）</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/338ee27e7ee84922856b105a732fc77b"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">认证过程</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/5ab7a39e1e244f08bcf5cfabd8b5f9c2"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">授权码模式</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/44c580a575bb40c9a02bbe383cf3be77"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">过程</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/9f8a82c9a5094c3ea46ca9aadb9c5add"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">简化模式</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/9a149da33bfa4db9b0921aa72c26c027"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">过程</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/26235848650240dbb44d31b280c30958"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">一些问题</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/ed68c3e1a042466aa7f1276a1d3f2def"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">为什么简化模式中不需要授权码和客户端密钥？</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/fd105941d92b4bc1933531351ecc34c2"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">为什么授权码模式需要授权码和access token？</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/369bcfde7a8840a8a083bc48e5872943"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">GitHub Oauth登录接入</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/eace2a3c09bf4878a61eb4a748161ee9"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">流程</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/4a289d44aca646ab8a6d3c9c9100cf30"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">代码</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/18820038902b400ea3aa3fadb0ea3d15"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">参考链接</span></span></div></a></li></ul><h1 id="https://www.notion.so/d33ece48ec6545f8b55e270c6658de0b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/d33ece48ec6545f8b55e270c6658de0b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">HTTP Basic Authentication</span></span></h1><div id="https://www.notion.so/3e30209f70d14996ac08c41fc543f21a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">HTTP Basic Authentication是允许用户HTTP代理（例如：网页浏览器）在请求时，提供用户名和密码的一种方式。</span></span></p></div><div id="https://www.notion.so/7aa0bc511b154619aa1df7d6db67325f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在进行基本认证的过程中，请求的HTTP头字段会包含Authorization字段，形势如下：</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Authorization: Basic &lt;凭证&gt;</code></span><span class="SemanticString"> ，该凭证是用户名和密码组成的base64编码。</span></span></p></div><h2 id="https://www.notion.so/8e7d13e2ee1f45bb8ab151c44891ee6e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/8e7d13e2ee1f45bb8ab151c44891ee6e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">认证过程</span></span></h2><div id="https://www.notion.so/a045d6fe79664b3bb519937a0fc6b369" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F609d1188-7b25-4efc-9634-b4324528b1b1%2FUntitled.png?width=710&amp;table=block&amp;id=a045d6fe-7966-4b3b-b519-937a0fc6b369"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F609d1188-7b25-4efc-9634-b4324528b1b1%2FUntitled.png?width=710&amp;table=block&amp;id=a045d6fe-7966-4b3b-b519-937a0fc6b369" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/13034303347e402685ad3e9383141b88" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">客户端向服务端请求一个需要权限的资源，服务端返回401 Unauthorized状态。</span></span></li><li id="https://www.notion.so/f5b6c9cca3d74c6c870ad6439a2b260c" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">客户端收到401 Unauthorized之后，给用户弹出输入框，用户输入用户名和密码。</span></span></li><li id="https://www.notion.so/7846d9a036344aff829d65a30b5ce510" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">客户端对用户名和密码执行base64编码得到登录凭证，并重新发送HTTP请求，请求头部包含</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Authorization: Basic &lt;凭证&gt;</code></span><span class="SemanticString">。</span></span></li><li id="https://www.notion.so/efd0e426fb4343129842d559400e0deb" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">服务器对凭证进行验证，验证通过则返回客户端请求的资源。</span></span></li></ol><div id="https://www.notion.so/a119b8635eee47be8aef52cad6c941b0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">输入界面如下所示：</span></span></p></div><div id="https://www.notion.so/834bb28806564fe7b52beda6742a2418" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fe327ae52-9886-4720-8236-32f2c6736147%2FUntitled.png?width=740&amp;table=block&amp;id=834bb288-0656-4fe7-b52b-eda6742a2418"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fe327ae52-9886-4720-8236-32f2c6736147%2FUntitled.png?width=740&amp;table=block&amp;id=834bb288-0656-4fe7-b52b-eda6742a2418" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h2 id="https://www.notion.so/43573e6438a6487ea64fbcfa411b697b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/43573e6438a6487ea64fbcfa411b697b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">优点</span></span></h2><ol class="NumberedListWrapper"><li id="https://www.notion.so/7a2be66141684972b833b42651239c98" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">HTTP Basic Authentication是一种十分简单的技术，其基于HTTP headers，而不是基于cookies、session、登录页面等技术来实现。</span></span></li><li id="https://www.notion.so/cf41f3932f014d6d8110accc6719e414" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">基本所有浏览器都支持HTTP Basic Authentication。</span></span></li><li id="https://www.notion.so/aeb39aa02db84c1a8e13257de3f4b5f7" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">但是HTTP Basic Authentication很少在公开访问的互联网网站使用，其有时会被用在小型私有系统中（如：路由器网页管理接口）。</span></span></li><li id="https://www.notion.so/9e537cc6457e4b09943d7f35f6369291" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">程序员和管理员有时会在可信网络环境使用HTTP Basic Authentication。因为其明文传输，便于诊断。</span></span></li></ol><h2 id="https://www.notion.so/b0a0c4f23f8e4261b8ad73ef8a1fafde" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/b0a0c4f23f8e4261b8ad73ef8a1fafde"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">缺点</span></span></h2><ol class="NumberedListWrapper"><li id="https://www.notion.so/8af344f4312d4c5ba9ae00f9586beb28" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">用户名和密码直接被明文传输，不安全，所以一般需要和HTTP一起使用。</span></span></li><li id="https://www.notion.so/c5b340f5000f412db59006cf34a37738" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">只有用户关闭标签页或浏览器，再或者用户清楚历史记录，密钥才会被清除。HTTP没有为服务器提供一种方法提示客户端丢弃缓存的密钥。这意味着服务端在用户不关闭浏览器的情况下，没有一种有效办法来让用户退出登录。</span></span></li></ol><h1 id="https://www.notion.so/5bcac628a404491faa383e4284155634" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/5bcac628a404491faa383e4284155634"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">HTTP Digest Authentication（HTTP摘要认证）</span></span></h1><div id="https://www.notion.so/eaf85573fa844b9fb86930baa2bd2010" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">HTTP认证是另一种Web服务器用来同浏览器进行认证协商的方法。它在密码发出之前，先对其应用哈希函数，这相对于HTTP Basic Authentication的明文传输更安全。</span></span></p></div><h2 id="https://www.notion.so/dfa9a12d307a459480bd522907da9590" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/dfa9a12d307a459480bd522907da9590"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">认证过程</span></span></h2><div id="https://www.notion.so/e346737c22c84c1a82b1e4c005408f59" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F44a1ce87-fe1e-4aff-8f0d-2a69db07a905%2FUntitled.png?width=3405&amp;table=block&amp;id=e346737c-22c8-4c1a-82b1-e4c005408f59"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F44a1ce87-fe1e-4aff-8f0d-2a69db07a905%2FUntitled.png?width=3405&amp;table=block&amp;id=e346737c-22c8-4c1a-82b1-e4c005408f59" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/e8026dd1c07a44ee8ef2d08569e7e0d2" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">客户端请求某个需要认证的资源</span></span></li><li id="https://www.notion.so/c12f844608b34d3db8adba35587141a9" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">服务端生成一个随机数，并将该随机数放置在HTTP response的headers。</span></span></li><li id="https://www.notion.so/b487a16e7ae44b248a2ac6fb3b130d66" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">客户端收到响应之后，对nouce、username、realm、password执行md5摘要算法，得到response字段。</span></span></li><li id="https://www.notion.so/325e3ca2200941e4a37ec87d5d55a7f2" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">客户端重新发起请求并传递nouce、realm、username、response资源。</span></span></li><li id="https://www.notion.so/55df928b592245499d856c8991c83e84" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString">服务端拥有和客户端相同的信息，于是执行与客户端相同的运算，判断结果是否一致：</span></span><ol class="NumberedListWrapper"><li id="https://www.notion.so/e0ce18b60c6740f28938152bdad9a034" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">一致则说明认证成功，返回相应资源；</span></span></li><li id="https://www.notion.so/75da85748be949329be93a595d6fdfbf" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">否则再次返回401 Unauthentication，并计算新的nouce。</span></span></li></ol></li></ol><h2 id="https://www.notion.so/ae80d802c82b434da68001f9e0290e88" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/ae80d802c82b434da68001f9e0290e88"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">优点</span></span></h2><ol class="NumberedListWrapper"><li id="https://www.notion.so/986f15d072fa44a28d79de9555cc10fa" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">密码并不是直接在摘要算法中使用，这就允许服务端可以只存储加密之后的密码；</span></span></li><li id="https://www.notion.so/a6dbc225f94b40ef8cadeb8edb60b354" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">服务端随机数允许包含时间戳，因此服务端可以检查客户端传递的nouce，避免重放攻击。</span></span></li></ol><h2 id="https://www.notion.so/51ee6e0d09a940fd86173c4d4878381d" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/51ee6e0d09a940fd86173c4d4878381d"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">缺点</span></span></h2><ol class="NumberedListWrapper"><li id="https://www.notion.so/d912b7d96681486496f20f3df2c8cef8" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">摘要算法容易收到中间人攻击。摘要认证算法没有提供任何机制帮助客户端验证服务端的身份。</span></span></li></ol><h1 id="https://www.notion.so/e4736dd2195b4fa0bea68999663c3cb3" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/e4736dd2195b4fa0bea68999663c3cb3"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">HTTP Bearer Authentication（HTTP持有人认证Oauth2）</span></span></h1><div id="https://www.notion.so/544f7ed6aabe45ca929f3bf735defeac" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Bearer Authentication是一种引入了Bearer token的HTTP认证协议。协议名字中的“持有人认证”可以被理解为：给予Bearer token持有人访问权限。Bearer token是一个加密字符串，由服务端在登录请求之后生成。客户端在每次访问需要权限的资源时都要在headers中包含该字段，格式为：</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Authorization: Bearer &lt;token&gt;</code></span><span class="SemanticString">。</span></span></p></div><div id="https://www.notion.so/20802c9bfcbe4d9fa4d46ac569d711c8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">区分一下这里的几个名字：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/8d5e39090121489ab56cc40d58f7edff" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">资源拥有者：一般指用户本身。</span></span></li><li id="https://www.notion.so/832ca1bacbc64652a093aaa680c0dfa1" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">客户端：需要请求需要权限的网站。</span></span></li><li id="https://www.notion.so/df439eabd7244c67996850f432b7efeb" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">服务端：资源所在的网站。</span></span></li></ul><div id="https://www.notion.so/0379fe6a8f734c24aeafd0bc5d2a6d43" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">例子：</span></span></p></div><div id="https://www.notion.so/e83d920c5aad4d72a3466a43c183e198" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">加入现在有个用户正在访问Weibo，并想使用QQ的Oauth2登录的方式登录Weibo。那么此时：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/8b8249ed371943b5bc84481ee644e397" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">用户为资源拥有者；</span></span></li><li id="https://www.notion.so/85c2224936aa4d659ed95c2a530afd28" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">客户端为Weibo；</span></span></li><li id="https://www.notion.so/8e82aa73fb1b4200ba9aad2ea9807c38" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">服务端为QQ。</span></span></li></ul><h2 id="https://www.notion.so/338ee27e7ee84922856b105a732fc77b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/338ee27e7ee84922856b105a732fc77b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">认证过程</span></span></h2><div id="https://www.notion.so/ab8a0dbd7e314063919b75e1ab85612c" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F6e9a5df6-eaf3-4b9e-bb7c-2f68fcaeef0c%2FUntitled.png?width=528&amp;table=block&amp;id=ab8a0dbd-7e31-4063-919b-75e1ab85612c"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F6e9a5df6-eaf3-4b9e-bb7c-2f68fcaeef0c%2FUntitled.png?width=528&amp;table=block&amp;id=ab8a0dbd-7e31-4063-919b-75e1ab85612c" style="width:528px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h2 id="https://www.notion.so/5ab7a39e1e244f08bcf5cfabd8b5f9c2" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/5ab7a39e1e244f08bcf5cfabd8b5f9c2"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">授权码模式</span></span></h2><h3 id="https://www.notion.so/44c580a575bb40c9a02bbe383cf3be77" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/44c580a575bb40c9a02bbe383cf3be77"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">过程</span></span></h3><ol class="NumberedListWrapper"><li id="https://www.notion.so/250710fcfb4040d3828717121b2c667a" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">用户访问客户端，客户端将用户导向至认证服务器；</span></span></li><li id="https://www.notion.so/33ba7c2ee0d64b75978d91da9b3a4bae" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">用户选择是否给客户端授权；</span></span></li><li id="https://www.notion.so/16d8ff3bb659491c8024865fcbc935c8" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">假设用户同意授权，认证服务器将用户重定向到客户端事先指定的“重定向URL”中，并附带上一个授权码；</span></span></li><li id="https://www.notion.so/626340c67d784fc4b217c79d12b0f813" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">客户端收到授权码之后，在后台服务器构造一条请求，请求内容包含&lt;授权码、客户端密钥、客户端ID&gt;等信息，向认证服务器申请令牌；</span></span></li><li id="https://www.notion.so/959a0fc7729d486caa27cb233db94095" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString">认证服务器确认授权码等信息无误，向客户端发送访问令牌（access token）和更新令牌（update token）。</span></span></li></ol><h2 id="https://www.notion.so/9f8a82c9a5094c3ea46ca9aadb9c5add" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/9f8a82c9a5094c3ea46ca9aadb9c5add"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">简化模式</span></span></h2><h3 id="https://www.notion.so/9a149da33bfa4db9b0921aa72c26c027" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/9a149da33bfa4db9b0921aa72c26c027"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">过程</span></span></h3><ol class="NumberedListWrapper"><li id="https://www.notion.so/bdeb8f3450914bae886b9cf97fe96e89" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">用户访问客户端，客户端将用户导向至认证服务器；</span></span></li><li id="https://www.notion.so/f9a76a94016747baac32346ff6c29266" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">用户选择是否给客户端授权；</span></span></li><li id="https://www.notion.so/c2adc97f8f7e4cb780a7968f278b6c55" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">假设用户同意授权，认证服务器将用户重定向到客户端事先指定的“重定向URL”中，并附带上一个Hash值；</span></span></li><li id="https://www.notion.so/b5573480fab045e5b73322bb36525a3a" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">客户端不携带Hash值，再次请求认证服务器；</span></span></li><li id="https://www.notion.so/7ea7df2b7bb144cc82d85318e1c4e17a" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString">服务端返回一个网页，网页中包含的代码可以获取Hash值中的令牌；</span></span></li><li id="https://www.notion.so/2a5e31a7b4d7406d84fb145cbe772b9d" class="NumberedList" value="6"><span class="SemanticStringArray"><span class="SemanticString">浏览器执行上一步的脚本，提取出令牌；</span></span></li><li id="https://www.notion.so/450ba1fbba0f475bb22688553098a3d1" class="NumberedList" value="7"><span class="SemanticStringArray"><span class="SemanticString">浏览器将令牌发送给客户端。</span></span></li></ol><h2 id="https://www.notion.so/26235848650240dbb44d31b280c30958" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/26235848650240dbb44d31b280c30958"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">一些问题</span></span></h2><h3 id="https://www.notion.so/ed68c3e1a042466aa7f1276a1d3f2def" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/ed68c3e1a042466aa7f1276a1d3f2def"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">为什么简化模式中不需要授权码和客户端密钥？</span></span></h3><div id="https://www.notion.so/3e0a9cd519e748a28cdffa14b5b8ca4a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们之所以可以在授权码模式中使用客户端密钥，是因为使用密钥请求token这一步是在客户端的服务器上进行的，可以保证该密钥对用户不可见。</span></span></p></div><div id="https://www.notion.so/c767bc8a200840d4acfcdd4ae78a1578" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">但是简化模式中并不会经过客户端的服务器，如果使用了密钥，那么该密钥对用户必须可见，也就没有意义，无法提高安全性，并且增加了运算量。</span></span></p></div><h3 id="https://www.notion.so/fd105941d92b4bc1933531351ecc34c2" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/fd105941d92b4bc1933531351ecc34c2"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">为什么授权码模式需要授权码和access token？</span></span></h3><ul class="BulletedListWrapper"><li id="https://www.notion.so/a32b912074654bdcba01771239acf433" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">这里授权码对用户是可见的，用户将授权码传递给客户端，之后客户端内部使用&lt;授权码、客户端密钥&gt;等信息获取access token；</span></span></li><li id="https://www.notion.so/e26d25cc1da842599417fd5e1a06fe0b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">access token对用户是不可见的，这样可以避免access token被恶意使用，进而提升系统的安全性。</span></span></li><li id="https://www.notion.so/4e08d108f276426882517c06995034bf" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">如果不同时使用授权码和access token则很难实现这一点。</span></span></li></ul><h2 id="https://www.notion.so/369bcfde7a8840a8a083bc48e5872943" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/369bcfde7a8840a8a083bc48e5872943"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">GitHub Oauth登录接入</span></span></h2><h3 id="https://www.notion.so/eace2a3c09bf4878a61eb4a748161ee9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/eace2a3c09bf4878a61eb4a748161ee9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">流程</span></span></h3><div id="https://www.notion.so/ee7f510d556145fea5d069f7287624f5" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F1051cad8-b9ef-49b0-bc20-3d51eb25716b%2FUntitled.png?width=816&amp;table=block&amp;id=ee7f510d-5561-45fe-a5d0-69f7287624f5"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F1051cad8-b9ef-49b0-bc20-3d51eb25716b%2FUntitled.png?width=816&amp;table=block&amp;id=ee7f510d-5561-45fe-a5d0-69f7287624f5" style="width:816px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/4a289d44aca646ab8a6d3c9c9100cf30" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/4a289d44aca646ab8a6d3c9c9100cf30"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">代码</span></span></h3><pre id="https://www.notion.so/47c141b19c5c49e4b12135126e039460" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">import</span> requests
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request

<span class="token keyword">from</span> setting <span class="token keyword">import</span> <span class="token operator">*</span>

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

URL <span class="token operator">=</span> <span class="token string">"https://github.com/login/oauth/authorize?client_id={client_id}&amp;scope={scope}&amp;redirect_uri={redirect_uri}"</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> URL<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>client_id<span class="token operator">=</span>client_id<span class="token punctuation">,</span> scope<span class="token operator">=</span>scope<span class="token punctuation">,</span> redirect_uri<span class="token operator">=</span>redirect_uri<span class="token punctuation">)</span>
    html <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'''
    &lt;h1>Hello World!&lt;/h1>
    &lt;a href="</span><span class="token interpolation"><span class="token punctuation">{</span>url<span class="token punctuation">}</span></span><span class="token string">">
    &lt;button>Login with Github&lt;/button>
    &lt;/a>
    '''</span></span>
    <span class="token keyword">return</span> html


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/callback'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    code <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'code'</span><span class="token punctuation">)</span>
    url <span class="token operator">=</span> <span class="token string">"https://github.com/login/oauth/access_token"</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">"client_id"</span><span class="token punctuation">:</span> client_id<span class="token punctuation">,</span>
        <span class="token string">"client_secret"</span><span class="token punctuation">:</span> client_secret<span class="token punctuation">,</span>
        <span class="token string">"code"</span><span class="token punctuation">:</span> code<span class="token punctuation">,</span>
        <span class="token string">"redirect_uri"</span><span class="token punctuation">:</span> <span class="token string">"http://49.232.185.170:8080/callback"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">"Accept"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    access_token <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'access_token'</span><span class="token punctuation">]</span>
    url <span class="token operator">=</span> <span class="token string">"https://api.github.com/user?access_token="</span> <span class="token operator">+</span> access_token
    headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"Authorization"</span><span class="token punctuation">:</span> <span class="token string">"token "</span> <span class="token operator">+</span> access_token
    <span class="token punctuation">}</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

    <span class="token keyword">return</span> response<span class="token punctuation">.</span>text


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8080</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span></span></span></code></pre><h1 id="https://www.notion.so/18820038902b400ea3aa3fadb0ea3d15" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/18820038902b400ea3aa3fadb0ea3d15"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">参考链接</span></span></h1><ul class="BulletedListWrapper"><li id="https://www.notion.so/fbad5a62781f499b8563d9ff79005480" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">HTTP身份验证的几种方案：</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Authentication">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Authentication</a></span></span></li><li id="https://www.notion.so/a45621d571eb4b1aa2e019eefc43de64" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">HTTP基本认证：</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://zh.wikipedia.org/wiki/HTTP%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81#%E7%BC%BA%E7%82%B9">https://zh.wikipedia.org/wiki/HTTP基本认证</a></span></span></li><li id="https://www.notion.so/e8b4cb54921e4a1f9e6798325e7d186c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">HTTP Basic Authentication与传统的Post登录应该如何选择：</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://stackoverflow.com/questions/8127635/why-should-i-use-http-basic-authentication-instead-of-username-and-password-post">https://stackoverflow.com/questions/8127635/why-should-i-use-http-basic-authentication-instead-of-username-and-password-post</a></span></span></li><li id="https://www.notion.so/57ddb83341f14b0aa31b8f932314071d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">HTTP摘要认证：</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://zh.wikipedia.org/wiki/HTTP%E6%91%98%E8%A6%81%E8%AE%A4%E8%AF%81">https://zh.wikipedia.org/wiki/HTTP摘要认证</a></span></span></li><li id="https://www.notion.so/f53e3060c01d451682fdeba6253a1f9c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">HTTP摘要认证：</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://datatracker.ietf.org/doc/html/rfc7616">https://datatracker.ietf.org/doc/html/rfc7616</a></span></span></li><li id="https://www.notion.so/6c2f785b6c3843909f66c74304658e09" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">HTTP摘要认证：</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://stackoverflow.com/questions/2384230/what-is-digest-authentication">https://stackoverflow.com/questions/2384230/what-is-digest-authentication</a></span></span></li><li id="https://www.notion.so/7fc8c9ad0f41409196412add606d49f6" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">持有人认证：</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://swagger.io/docs/specification/authentication/bearer-authentication/">https://swagger.io/docs/specification/authentication/bearer-authentication/</a></span></span></li><li id="https://www.notion.so/946db2edc114441ea3e0bac35ccb99b0" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">持有人认证：</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html">https://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html</a></span></span></li><li id="https://www.notion.so/fc7147c7355743c281c207094836cbc8" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">关于持有人认证两种模式的问题：h</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html#comment-353496">ttps://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html#comment-353496</a></span></span></li><li id="https://www.notion.so/ee394405d5e34de0956199f158de3a92" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">GitHub接入Oauth2: </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://docs.github.com/cn/developers/apps/building-oauth-apps/authorizing-oauth-apps">https://docs.github.com/cn/developers/apps/building-oauth-apps/authorizing-oauth-apps</a></span></span></li></ul></article>
  <script src="https://utteranc.es/client.js"
    repo="shaojunying/shaojunying.github.io"
    issue-term="title"
    label="Comment"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>
  <footer class="Footer">
  <div>&copy; Junying Shao&#39;s Blog 2022</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>